#!/bin/bash
# postrm script
#
# see: dh_installdeb(1)

if [ "$1" == "purge" ] || [ "$1" == "remove"]; then
    function unlink_if_existing() {
        if [ -L "$1" ]; then
            unlink $1
        fi
    }

    # cleanup and unlink our symlinks
    unlink_if_existing /etc/nginx/nginx.conf
    unlink_if_existing /etc/nginx/sites-enabled/wlanpi_core.conf
fi

if [ "$1" == "purge" ]; then
    # maintainer scripts may be run more than once.
    # cleanup our users we created during postinst
    APIUSER="wlanpi_api"
    USER_EXISTS=$(getent passwd $APIUSER)

    if [ -z "$USER_EXISTS" ]; then
        echo "User $APIUSER does not exist ..."
    else
        echo "User $APIUSER exists, deleting ..."
        deluser "$APIUSER" --only-if-empty
    fi

    # remove logs
    echo "Purging logs from /var/log/wlanpi-core ..."
    rm /var/log/wlanpi-core/*.log
fi

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
