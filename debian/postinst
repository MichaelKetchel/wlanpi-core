#!/bin/bash
# see: dh_installdeb(1)
# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

# function to check if a path is a symlink
function isValidSymlink() {
    if [ -L "$1" ]; then
        return 0
    else
        return 1
    fi
}

# get python version, remove spaces, get Python3.7 or Python3.9, lowercase
PYTHONSTUB=`python3 -V 2>&1 | sed 's/ //g' | grep -oP '(\w+\.\d+)' | tr 'P' 'p'`

# target working directory
WORKINGDIRECTORY=/opt/wlanpi-core/lib/$PYTHONSTUB/site-packages/wlanpi_core

# link
LINK=/opt/wlanpi-core/workingdirectory

if ! isValidSymlink $WORKINGDIRECTORY; then
    ln -s $WORKINGDIRECTORY $LINK
fi

# if wlanpi_core.conf is not a symlink, create symlink.
WLANPI_CORE=/etc/nginx/sites-enabled/wlanpi_core.conf
if ! isValidSymlink $WLANPI_CORE; then
    echo "Linking wlanpi_core.conf ..."
    ln -s /etc/wlanpi-core/nginx/sites-enabled/wlanpi_core.conf $WLANPI_CORE
    CONF_CHANGED=0
fi

# check nginx actually exists first
if which nginx; then
    echo "Restarting nginx ..."
    systemctl restart nginx.service
fi

exit 0
